{% extends "master.html" %}
{% load i18n %}
{% load humanize %}
{% load staticfiles %}
{% load filters_extra %}


{% block title %}
  Analytics - {{campaign.email_list.name}} - {{campaign.email_subject}}
{% endblock %}


{% block content %}

  <div class='container'>
    <div class='row'>
      <div class='col-lg-6 col-sm-6'>
        <h3>
          {% trans "Analytics" %} - {{campaign.email_list.name}} - {{campaign.email_subject}}
        </h3>
      </div>
    </div>
    <hr />
    <canvas id="myChart" width="4" height="2"></canvas>
    <h4>{% trans "Open rate" %}:</h4>
    <table class="table table-striped">
        <thead>
            <tr>
                <th></th>
                <th>{% trans "unique" %}</th>
                <th>{% trans "total" %}</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>{% trans "Open statistics" %}</td>
                <td>{{open_rate_object.unique_count}}</td>
                <td>{{open_rate_object.total_count}}</td>
            </tr>
        </tbody>
    </table>
    <h4>{% trans "Click rate" %}:</h4>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>URI</th>
                <th>{% trans "unique" %}</th>
                <th>{% trans "total" %}</th>
            </tr>
        </thead>
        <tbody>
            {% for item in click_rate_object %}
            <tr>
                <td>{{item.uri|decodeURI}}</td>
                <td>{{item.unique_count}}</td>
                <td>{{item.total_count}}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <h4>{% trans "SES rate" %}:</h4>
    <table class="table table-striped">
        <thead>
            <tr>
                <th></th>
                <th>{% trans "delivery" %}</th>
                <th>{% trans "bounce" %}</th>
                <th>{% trans "complaint" %}</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>{% trans "SES statistics" %}</td>
                <td>{{ ses_rate_object.delivery_count }}</td>
                <td>{{ ses_rate_object.bounce_count }}</td>
                <td>{{ ses_rate_object.complaint_count }}</td>
            </tr>
        </tbody>
    </table>
  </div>
{% endblock %}


{% block script %}
<script src='{% static "js/vendor/chart.min.js" %}'></script>
<script>
    $.get(
        "{% url 'analytics-management-api-open-date-by-merger' campaign.email_list.uuid campaign.uuid 'hour' %}",
        "",
        function(data) {

            var labels = []
            var dataUnique = []
            for (var i = 0; i < data.length; i++) {
                labels.push(data[i].date)
                dataUnique.push(data[i].unique_count)
            }
            var ctx = document.getElementById("myChart");
            var myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Unique open',
                        data: dataUnique,
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        yAxes: [{
                            ticks: {
                                beginAtZero:true
                            }
                        }]
                    }
                }
            });
        }
  )
</script>
{% endblock %}
